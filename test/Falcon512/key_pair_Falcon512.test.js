const nearApi = require('../../src/index');
const { sha256 } = require('js-sha256');

test('test sign and verify with random (FALCON512)', async () => {
    const message = new Uint8Array(sha256.array('message'));
    const keyPair = nearApi.utils.key_pair.KeyPairEd25519.fromRandom();
    const signature = keyPair.sign(message);
    expect(keyPair.verify(message, signature.signature)).toBeTruthy();
});

test('convert to string (FALCON512)', async () => {
    const keyPair = nearApi.utils.key_pair.KeyPairFalcon512.fromRandom();
    const newKeyPair = nearApi.utils.key_pair.KeyPair.fromString(keyPair.toString());
    expect(newKeyPair.secretKey).toEqual(keyPair.secretKey);

    const keyString = 'falcon512:2prjFkTciQYMD68X3XVtHyTkT2VXUxLowJnBwSwAneRJAbbTNzXzkt8rhX33RQP4jHhMXAHonvsBanepcB5KoKV3nPMndyjXj22mGyTc7NfWd9dCoYpD6aYyW1HThZURVntvDBRncLGAA9UYM7KKVA38EPC2yuSTbDFbcv7wTcLhkwBXAxZFGe4sqmX9zBM884d9uuS349vpXj2iaaYbTHf2dv9f2fTWtmLDuiDz8L8GTDBNH6ffEmtJmLqeDU5TsiFXwwE7RWovenTCLXxKDpAK7UCWuRpE5t69GGCCZTWDXepMwU1zWqfYfCAksF1vuLchTxNyMU7C9nASkCWQATn3fYsWSbZWAGbPPHMBzSmDPaxw53KkrJZnHzyQZK7LV34zdf4TSTQ9g7R422pRi1XUYrpa22ur6kdXLDcAn8iUcf7sKEpVRzMS5DvRsromnLFqwcLsdGBF7sYfm6Qv4LXq9Hwcc766hZTUnHXfgvaYwfi5xGpgRM8eaqBq5DKLHr5DKV3sCwzZmGTYYnM1ShkdQe1K4mMe8eEicw9cYoXJhRoxCTsjQVqpkinrL6gzEks9Gevyb72FCy1YeUyuoRF7gcG9yk6To4JYgP2woiYQWYdNyyAUQfm7rXPznbwFf9JCaYzQxKT4mVEvrhFiNJk2AtxbzMHh8HpVPa913YSjEnyP7QcJXQD8TmLWJeCgkX7YaqsEyvReNEy6aH5ACSERs6YqJipNKcjV8owVoMF42Au4ZhRZqHmTcgresbdzJoibtLvUZY4qbpmpAfH28V15SEK9mhUcRBsG7MVBCZ5SLUPMcz62JycxK3Gr8fWkxVyvR4kF22hV3w2hSkqjrgf97WomQU81Rt9q3KpbF8kR4zyCj37Z41AojZbgSg9yzgL6PQiZorDbjWsvqFmkT4SCH8FdYKHY6UkfE7uYnx1jYzKr86MUfwNsg5ZgYyyPvfA5gtLBdNTaGq5GxtPX8qhvFfrNpMzVTKW9nmQYTfU8T2G8XdGAVEM3Z5sXg7qCh6jLtqnyjXwfVnFXvGz5ryhnwANoge4uoj7LBynrzEwVdSyhFPpnkCE2WkwBTaAq4X4s7upxjz7v9t2XexMubFT1ajgBpR3q7AMUaTfe1TCodop94FuQa2QSmvoc6eFWYKx2iyUhr3oo5NJWoQLXX6srfyUwTaqHPdjvHgwHXJBCRW8nYkh7DYfmMZncunfDVHzowBow82dnnDEgUYajHsf1g7FsEsobdeLpkNAHLjNe6yQ3nXmW3ZGBhY4VD6eHeU52DJsGSvUC7HPAysFTCGQDuZrtcSAgHeKZ5JFvw5QgCXBptmhdAatjiENqeRs5DsxBcnmJ38QB9Uta5aKXssPonRDtUrQhsHddGKxCZZEAJocemjxnuRab8ttE1hXfCyDPapoVq7sBNQBtwzW2ZsB2QL27YKdQxJ8uvn4gAcm2sb8q5xhAYBLc9AoSJU2phRfB3e2N2Ned2cuSz27KxSWxaoYhQXGHp3auebCS8kjRpYkyTARcKubzuWNwfKp4URSBpMChpops9mzET7R7TTGn6c6n5JZnzgZwS2FYkpd4F6r6dV6AsCk5bmUiixWTfhUoPCgsebMiKfDzwPuTrwg1YRywv1kpZ7JAa7YXzqeTdqjNjEwUZJ3ktQBkRMwbC5WBbMTZRLhwjzPg1VhTjwLaREkh5xMjW8f8xgMaM1EG5GepZLkzyqPA1cBCQMAD6p9ZXuhzjp9By25eUMNa8Z';
    const keyPair2 = nearApi.utils.key_pair.KeyPair.fromString(keyString);
    expect(keyPair2.toString()).toEqual(keyString);
});

test('test sign and verify with public key (FALCON512)', async () => {
    const message = new Uint8Array(sha256.array('message'));
    const keyPair = new nearApi.utils.key_pair.KeyPairFalcon512('2prjFkTciQYMD68X3XVtHyTkT2VXUxLowJnBwSwAneRJAbbTNzXzkt8rhX33RQP4jHhMXAHonvsBanepcB5KoKV3nPMndyjXj22mGyTc7NfWd9dCoYpD6aYyW1HThZURVntvDBRncLGAA9UYM7KKVA38EPC2yuSTbDFbcv7wTcLhkwBXAxZFGe4sqmX9zBM884d9uuS349vpXj2iaaYbTHf2dv9f2fTWtmLDuiDz8L8GTDBNH6ffEmtJmLqeDU5TsiFXwwE7RWovenTCLXxKDpAK7UCWuRpE5t69GGCCZTWDXepMwU1zWqfYfCAksF1vuLchTxNyMU7C9nASkCWQATn3fYsWSbZWAGbPPHMBzSmDPaxw53KkrJZnHzyQZK7LV34zdf4TSTQ9g7R422pRi1XUYrpa22ur6kdXLDcAn8iUcf7sKEpVRzMS5DvRsromnLFqwcLsdGBF7sYfm6Qv4LXq9Hwcc766hZTUnHXfgvaYwfi5xGpgRM8eaqBq5DKLHr5DKV3sCwzZmGTYYnM1ShkdQe1K4mMe8eEicw9cYoXJhRoxCTsjQVqpkinrL6gzEks9Gevyb72FCy1YeUyuoRF7gcG9yk6To4JYgP2woiYQWYdNyyAUQfm7rXPznbwFf9JCaYzQxKT4mVEvrhFiNJk2AtxbzMHh8HpVPa913YSjEnyP7QcJXQD8TmLWJeCgkX7YaqsEyvReNEy6aH5ACSERs6YqJipNKcjV8owVoMF42Au4ZhRZqHmTcgresbdzJoibtLvUZY4qbpmpAfH28V15SEK9mhUcRBsG7MVBCZ5SLUPMcz62JycxK3Gr8fWkxVyvR4kF22hV3w2hSkqjrgf97WomQU81Rt9q3KpbF8kR4zyCj37Z41AojZbgSg9yzgL6PQiZorDbjWsvqFmkT4SCH8FdYKHY6UkfE7uYnx1jYzKr86MUfwNsg5ZgYyyPvfA5gtLBdNTaGq5GxtPX8qhvFfrNpMzVTKW9nmQYTfU8T2G8XdGAVEM3Z5sXg7qCh6jLtqnyjXwfVnFXvGz5ryhnwANoge4uoj7LBynrzEwVdSyhFPpnkCE2WkwBTaAq4X4s7upxjz7v9t2XexMubFT1ajgBpR3q7AMUaTfe1TCodop94FuQa2QSmvoc6eFWYKx2iyUhr3oo5NJWoQLXX6srfyUwTaqHPdjvHgwHXJBCRW8nYkh7DYfmMZncunfDVHzowBow82dnnDEgUYajHsf1g7FsEsobdeLpkNAHLjNe6yQ3nXmW3ZGBhY4VD6eHeU52DJsGSvUC7HPAysFTCGQDuZrtcSAgHeKZ5JFvw5QgCXBptmhdAatjiENqeRs5DsxBcnmJ38QB9Uta5aKXssPonRDtUrQhsHddGKxCZZEAJocemjxnuRab8ttE1hXfCyDPapoVq7sBNQBtwzW2ZsB2QL27YKdQxJ8uvn4gAcm2sb8q5xhAYBLc9AoSJU2phRfB3e2N2Ned2cuSz27KxSWxaoYhQXGHp3auebCS8kjRpYkyTARcKubzuWNwfKp4URSBpMChpops9mzET7R7TTGn6c6n5JZnzgZwS2FYkpd4F6r6dV6AsCk5bmUiixWTfhUoPCgsebMiKfDzwPuTrwg1YRywv1kpZ7JAa7YXzqeTdqjNjEwUZJ3ktQBkRMwbC5WBbMTZRLhwjzPg1VhTjwLaREkh5xMjW8f8xgMaM1EG5GepZLkzyqPA1cBCQMAD6p9ZXuhzjp9By25eUMNa8Z');
    const signature = keyPair.sign(message);
    const publicKey = nearApi.utils.key_pair.PublicKey.from('falcon512:33voTQqbGnpngJrBqX3UZL6WXTzxpeVYeBoxPb3fy7ct4hJ5M4VkuDmUCUo49Jgwiffbgfk5797JVLQUGm5jimev14djD9EAzBPWQmqm1WQE5oHK71pDUBVo8Szs1DyEsmQGF4yG9VzTmfa79BfKE486HxsVQ5byn6nKb9vMdd1VAFP4g8MJKhSwXVpqLh5SG6E6THLxTb8Gbf6CnAE1RD7VC1Z4K67PM7vNyqbb2JdQFaDPjBm5vuNVdA31mkrt7HRt2ARMGddjVRQcZNd8eQ1imvV22WuxKcod7tKGz8NN9G3uUmahvQZXHkoQmjerFGQ9YHqhaTqn956hh95UwiRKXMNuE4ERpH3imj713MCvmYbSm8KhL3DzShzbkyRekjTNvsiHWAGWjzdBiJKrnjzUc1Qm16ZAyRr4ZhGw9zK1F7ouoKFKUQXgTpsHoeYLsDF6WGvo4QCkCuppJxS34hxjr23eLoRudx7bYwX17gb6gmdSAZE1A3DFGW2kW8qEpMc4asLFyHUzcmqCjQnCiHjwZsN9B1HxU9EBog9djCvExbsU4a16DFf1Pv3EuyiskrSWuRuKifjC92w2Kk1NFb87d2yRfbjAJCMMCKpXVAtrTDb1nPm4GBdLoRRd6NEm5fidxhwaH58f6B874ym6RJt6wBV2Q1LEgSzAGrZBktsu1sWt8ueZkyHRS7WSLuHQtKeVLZn8MjXWb1yrCzJBeVJS8VVKJ3iEJRZS77568aruyZEMu1fe8jq5MXDG1LacHkaCX4vYpfXLRd8dZcASYyQZ6EoFxoYdoturAnJXZo3mqbH4WMALcgo45tTncCXBxhXdhxNMLF9pWnyAm2ajRxsWHoYg6rzBMnoQjRPpQZ3GragsLLHsFVmDvw2sPsdnHoc1h31YVBVV9TzXfTAigYwcamUuoGZbSHmwiamzdUYu838hJiFJCNnVFAQ3VrMEvzt6R28SPj32WhzZpKBLDWcoRkymSJBm1WmmzbEsufHNcHBFARuSpinF7yK1hV6KSCbsdEkV5Ps3TqTe5KcRcPQF5viL9tY8iFh3k6uB4ZvqsdGmpahJNpc62WnMDLnWcNoZDKqAFiJo3yiW1MRCteM95ZNbdPqJPGU87BkP5MMQVUG6PzDEhowqshhAYABWH8U3mhXcjsPz8iGRauasDxCnZi1tzRp8oPSeVMZVPbDeKcvqsBW3Le49xh14esotN3Eq1YJYD');
    expect(publicKey.verify(message, signature.signature)).toBeTruthy();
});

test('test from secret (FALCON512)', async () => {
    const keyPair = new nearApi.utils.key_pair.KeyPairFalcon512('2prjFkTciQYMD68X3XVtHyTkT2VXUxLowJnBwSwAneRJAbbTNzXzkt8rhX33RQP4jHhMXAHonvsBanepcB5KoKV3nPMndyjXj22mGyTc7NfWd9dCoYpD6aYyW1HThZURVntvDBRncLGAA9UYM7KKVA38EPC2yuSTbDFbcv7wTcLhkwBXAxZFGe4sqmX9zBM884d9uuS349vpXj2iaaYbTHf2dv9f2fTWtmLDuiDz8L8GTDBNH6ffEmtJmLqeDU5TsiFXwwE7RWovenTCLXxKDpAK7UCWuRpE5t69GGCCZTWDXepMwU1zWqfYfCAksF1vuLchTxNyMU7C9nASkCWQATn3fYsWSbZWAGbPPHMBzSmDPaxw53KkrJZnHzyQZK7LV34zdf4TSTQ9g7R422pRi1XUYrpa22ur6kdXLDcAn8iUcf7sKEpVRzMS5DvRsromnLFqwcLsdGBF7sYfm6Qv4LXq9Hwcc766hZTUnHXfgvaYwfi5xGpgRM8eaqBq5DKLHr5DKV3sCwzZmGTYYnM1ShkdQe1K4mMe8eEicw9cYoXJhRoxCTsjQVqpkinrL6gzEks9Gevyb72FCy1YeUyuoRF7gcG9yk6To4JYgP2woiYQWYdNyyAUQfm7rXPznbwFf9JCaYzQxKT4mVEvrhFiNJk2AtxbzMHh8HpVPa913YSjEnyP7QcJXQD8TmLWJeCgkX7YaqsEyvReNEy6aH5ACSERs6YqJipNKcjV8owVoMF42Au4ZhRZqHmTcgresbdzJoibtLvUZY4qbpmpAfH28V15SEK9mhUcRBsG7MVBCZ5SLUPMcz62JycxK3Gr8fWkxVyvR4kF22hV3w2hSkqjrgf97WomQU81Rt9q3KpbF8kR4zyCj37Z41AojZbgSg9yzgL6PQiZorDbjWsvqFmkT4SCH8FdYKHY6UkfE7uYnx1jYzKr86MUfwNsg5ZgYyyPvfA5gtLBdNTaGq5GxtPX8qhvFfrNpMzVTKW9nmQYTfU8T2G8XdGAVEM3Z5sXg7qCh6jLtqnyjXwfVnFXvGz5ryhnwANoge4uoj7LBynrzEwVdSyhFPpnkCE2WkwBTaAq4X4s7upxjz7v9t2XexMubFT1ajgBpR3q7AMUaTfe1TCodop94FuQa2QSmvoc6eFWYKx2iyUhr3oo5NJWoQLXX6srfyUwTaqHPdjvHgwHXJBCRW8nYkh7DYfmMZncunfDVHzowBow82dnnDEgUYajHsf1g7FsEsobdeLpkNAHLjNe6yQ3nXmW3ZGBhY4VD6eHeU52DJsGSvUC7HPAysFTCGQDuZrtcSAgHeKZ5JFvw5QgCXBptmhdAatjiENqeRs5DsxBcnmJ38QB9Uta5aKXssPonRDtUrQhsHddGKxCZZEAJocemjxnuRab8ttE1hXfCyDPapoVq7sBNQBtwzW2ZsB2QL27YKdQxJ8uvn4gAcm2sb8q5xhAYBLc9AoSJU2phRfB3e2N2Ned2cuSz27KxSWxaoYhQXGHp3auebCS8kjRpYkyTARcKubzuWNwfKp4URSBpMChpops9mzET7R7TTGn6c6n5JZnzgZwS2FYkpd4F6r6dV6AsCk5bmUiixWTfhUoPCgsebMiKfDzwPuTrwg1YRywv1kpZ7JAa7YXzqeTdqjNjEwUZJ3ktQBkRMwbC5WBbMTZRLhwjzPg1VhTjwLaREkh5xMjW8f8xgMaM1EG5GepZLkzyqPA1cBCQMAD6p9ZXuhzjp9By25eUMNa8Z');
    expect(keyPair.publicKey.toString()).toEqual('falcon512:33voTQqbGnpngJrBqX3UZL6WXTzxpeVYeBoxPb3fy7ct4hJ5M4VkuDmUCUo49Jgwiffbgfk5797JVLQUGm5jimev14djD9EAzBPWQmqm1WQE5oHK71pDUBVo8Szs1DyEsmQGF4yG9VzTmfa79BfKE486HxsVQ5byn6nKb9vMdd1VAFP4g8MJKhSwXVpqLh5SG6E6THLxTb8Gbf6CnAE1RD7VC1Z4K67PM7vNyqbb2JdQFaDPjBm5vuNVdA31mkrt7HRt2ARMGddjVRQcZNd8eQ1imvV22WuxKcod7tKGz8NN9G3uUmahvQZXHkoQmjerFGQ9YHqhaTqn956hh95UwiRKXMNuE4ERpH3imj713MCvmYbSm8KhL3DzShzbkyRekjTNvsiHWAGWjzdBiJKrnjzUc1Qm16ZAyRr4ZhGw9zK1F7ouoKFKUQXgTpsHoeYLsDF6WGvo4QCkCuppJxS34hxjr23eLoRudx7bYwX17gb6gmdSAZE1A3DFGW2kW8qEpMc4asLFyHUzcmqCjQnCiHjwZsN9B1HxU9EBog9djCvExbsU4a16DFf1Pv3EuyiskrSWuRuKifjC92w2Kk1NFb87d2yRfbjAJCMMCKpXVAtrTDb1nPm4GBdLoRRd6NEm5fidxhwaH58f6B874ym6RJt6wBV2Q1LEgSzAGrZBktsu1sWt8ueZkyHRS7WSLuHQtKeVLZn8MjXWb1yrCzJBeVJS8VVKJ3iEJRZS77568aruyZEMu1fe8jq5MXDG1LacHkaCX4vYpfXLRd8dZcASYyQZ6EoFxoYdoturAnJXZo3mqbH4WMALcgo45tTncCXBxhXdhxNMLF9pWnyAm2ajRxsWHoYg6rzBMnoQjRPpQZ3GragsLLHsFVmDvw2sPsdnHoc1h31YVBVV9TzXfTAigYwcamUuoGZbSHmwiamzdUYu838hJiFJCNnVFAQ3VrMEvzt6R28SPj32WhzZpKBLDWcoRkymSJBm1WmmzbEsufHNcHBFARuSpinF7yK1hV6KSCbsdEkV5Ps3TqTe5KcRcPQF5viL9tY8iFh3k6uB4ZvqsdGmpahJNpc62WnMDLnWcNoZDKqAFiJo3yiW1MRCteM95ZNbdPqJPGU87BkP5MMQVUG6PzDEhowqshhAYABWH8U3mhXcjsPz8iGRauasDxCnZi1tzRp8oPSeVMZVPbDeKcvqsBW3Le49xh14esotN3Eq1YJYD');
});